{% extends 'contributions/base.html' %}

{% block title %}{{ group.name }} Details{% endblock %}

{% block content %}
<section class="hero">
<div class="hero-text">   
<p><strong>Created At:</strong> {{ group.created_at|date:"D, d M Y, h:i A" }}</p>

<hr>

<h2>{{ group.name }} Details</h2>
<p>Admin: {{ group.admin.username }}</p>
<p>Weekly Contribution: Ksh {{ group.weekly_contribution }}</p>
<p>Total Group Balance: Ksh {{ total_balance }}</p>


<form method="post" action="{% url 'contribute' %}">
    {% csrf_token %}
    <input type="hidden" name="group_id" value="{{ group.id }}">
    <input type="number" name="amount" placeholder="Amount to contribute">
    <button type="submit">Contribute</button>
</form>

<a href="{% url 'contribution_history' group.id %}">View Contribution History</a>


<p><strong>Next Payout:</strong></p>
<ul>
    <p>Member: {{ next_member.username }}</p>
    <p>Date: {{ next_payout_date|date:"D, d M Y, h:i A" }}</p>
    <p>Amount: {{ total_balance|floatformat:2 }}</p>
</ul>

<hr>

<h2>Members</h2>
<ul>
    {% for member in group.members.all %}
        <p>{{ member.username }}</p>
    {% endfor %}
</ul>

<hr>

{% if user == group.admin %}
    <h2>Manage Members</h2>
    <form method="post" action="{% url 'group_detail' group.id %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" name="manage_member">Submit</button>
    </form>

    <!-- <h2>Generate Join Code</h2>
    <form method="post" action="{% url 'group_detail' group.id %}">
        {% csrf_token %}
        <button type="submit" name="generate_code">Generate Code</button>
    </form> -->

    {% if group.join_code %}
        <p>Join Code: <strong>{{ group.join_code }}</strong></p>
    {% endif %}
{% endif %}

<a href="{% url 'dashboard' %}">Back to Dashboard</a>
</div> 
</section>
{% endblock %}
